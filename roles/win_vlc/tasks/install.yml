---
- name: "Préparer le répertoire temporaire"
  ansible.windows.win_file:
    path: "{{ vlc_temp_dir }}"
    state: directory

- name: "Copier le ZIP VLC sur la cible"
  ansible.windows.win_copy:
    src: "{{ vlc_zip }}"
    dest: "{{ vlc_temp_dir }}\\{{ vlc_zip }}"

- name: "Dézipper le package VLC"
  ansible.windows.win_shell: >
    PowerShell -NoProfile -NonInteractive -Command
    "Expand-Archive -LiteralPath '{{ vlc_temp_dir }}\\{{ vlc_zip }}' -DestinationPath '{{ vlc_temp_dir }}' -Force"
  args:
    creates: "{{ vlc_temp_dir }}\\{{ vlc_installer }}"

- name: "Installation VLC"
  ansible.windows.win_package:
    path: "{{ vlc_temp_dir }}\\{{ vlc_installer }}"
    arguments: "/S"
    state: present
    log_path: "{{ vlc_log_file }}"
  register: install_out

- set_fact:
    package_status: "installed"
    package_message: "VLC installé"
    reboot_required: "{{ install_out.reboot_required | default(false) }}"

